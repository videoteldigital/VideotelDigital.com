/*
* Copyright 2014 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

$(document).ready(function () { (function (e, b, q) { function n() { var a = A(), c = a.buttonsParameters; if (0 < c.length) { var d = b.getAttrValFromDom(k, "data-getAjaxCartButtonUrl"); b.ajax({ cache: !1, type: "POST", data: b.toJSON(c), contentType: "application/json; charset=utf-8", url: d, success: function (c) { if ("" != c) for (var f = 0; f < a.addToCartButtons.length; f++) { var d = a.addToCartButtons[f], g = b(c).filter("div[data-productId='" + d.productId + "']"); if (g && 0 < g.length) { var r = b.getAttrValFromDom(g, "data-isProductPage"); r && r == d.isProductPage.toString() && b(d.buttonElement).replaceWith(g[0]) } } }, error: function (b, a, c) { } }) } } function B(a) { if (!e.waitForAjaxRequest) { e.waitForAjaxRequest = !0; var c = b.getHiddenValFromDom("#addProductToCartUrl"), d = b.getHiddenValFromDom("#checkProductAttributesUrl"), l = b.getAttrValFromDom(a.currentTarget, "data-productId"), f = C(a.currentTarget); a = { productId: l, quantity: f }; s(); var m = !1, g = !1; b.ajax({ cache: !1, async: !1, type: "POST", dataType: "json", data: b.toJSON(a), contentType: "application/json; charset=utf-8", url: d, success: function (b) { m = b.HasProductAttributes }, error: function (b, a, c) { g = !0 } }); g ? (h(), e.waitForAjaxRequest = !1) : m ? (D(l, f), h(), e.waitForAjaxRequest = !1) : b.ajax({ cache: !1, type: "POST", dataType: "json", data: b.toJSON(a), contentType: "application/json; charset=utf-8", url: c, success: function (a) { h(); e.waitForAjaxRequest = !1; "success" == a.Status ? (t(), u(), v(), w(f), x(a.ProductAddedToCartWindow), b.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" })) : "warning" == a.Status ? y(a.AddToCartWarnings) : "error" == a.Status && y(a.ErrorMessage) }, error: function (b, a, c) { h(); e.waitForAjaxRequest = !1 } }) } } function E(a, c) { c == q && (c = !1); if (!e.waitForAjaxRequest) { e.waitForAjaxRequest = !0; var d = b(a.currentTarget), l = b.getHiddenValFromDom("#addProductVariantToCartUrl"), f = b.getAttrValFromDom(a.currentTarget, "data-productId"), m = F(d), d = b(d).closest("form").serialize(); 0 == d.length && (formSelector = b("body").find("form"), d = b(formSelector).serialize()); d += "&productId=" + f; c ? G() : s(); b.ajax({ cache: !1, type: "POST", data: d, url: l, success: function (a) { if ("warning" == a.Status || "error" == a.Status) if (p(c), e.waitForAjaxRequest = !1, a = a.AddToCartWarnings, c) b(".miniProductDetailsView .message-error").html(a); else { var f = b(".addProductVariantToCartErrors").data("kendoWindow"); f || (f = b(".addProductVariantToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), f.wrapper.addClass("ajaxCart")); f.content(a); f.center(); f.open() } else t(), v(), w(m), u(), c && b(".miniProductDetailsView").data("kendoWindow").close(), p(c), e.waitForAjaxRequest = !1, x(a.ProductAddedToCartWindow), b.event.trigger({ type: "nopAjaxCartProductAddedToCartEvent" }) }, error: function (b, a, f) { p(c); e.waitForAjaxRequest = !1 } }) } } function H() { var a = b("body"); 0 == a.find(".nopAjaxCartPanelAjaxBusy").length && (a.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div><div class="clear"></div>'), b(".nopAjaxCartPanelAjaxBusy").hide()); 0 == a.find(".nopAjaxCartPanelAjaxBusy").length && (a.prepend('<div class="nopAjaxCartPanelAjaxBusy"></div><div class="clear"></div>'), b(".nopAjaxCartPanelAjaxBusy").hide()) } function I() { var a = b("body"); 0 < a.length && (a.prepend('<div class="productAddedToCartWindow"></div>'), a.prepend('<div class="miniProductDetailsView"></div>'), a.prepend('<div class="addProductVariantToCartErrors"></div>'), a.prepend('<div class="addProductToCartErrors"></div>'), b(".miniProductDetailsView").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart")); b(".productAddedToCartWindow").kendoWindow({ draggable: !1, resizable: !1, modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow").wrapper.addClass("ajaxCart") } function A() { var a = b.getAttrValFromDom(k, "data-productPageAddToCartButtonSelector"), c = b.getAttrValFromDom(k, "data-productBoxAddToCartButtonSelector"), d = [], e = []; b(a).each(function () { if (!b(this).is(".nopAjaxCartProductVariantAddToCartButton")) { var a = b.getAttrValFromDom(this, "data-productid", 0); if (a && 0 < a) { var c = { productId: a, isProductPage: !0, buttonElement: b(this) }, a = { productId: a, isProductPage: !0, buttonValue: z(b(this)) }; d.push(c); e.push(a) } } }); b(c).each(function () { if (!b(this).is(".nopAjaxCartProductListAddToCartButton")) { var a; var c = b(this); a = b.getAttrValFromDom(k, "data-productBoxProductItemElementSelector"); a = a == q || "" == a ? 0 : b.getAttrValFromDom(b(c).parents(a), "data-productid", 0); a && 0 < a && (c = { productId: a, isProductPage: !1, buttonElement: b(this) }, a = { productId: a, isProductPage: !1, buttonValue: z(b(this)) }, d.push(c), e.push(a)) } }); return { addToCartButtons: d, buttonsParameters: e } } function z(a) { return b.getAttrValFromDom(a, "value") } function p(a) { a ? b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").hide() : h() } function G() { if (0 < b(".miniProductDetailsView").length) { var a = b(".miniProductDetailsView").parent().height(), c = b(".miniProductDetailsView").parent().width(); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").height(a - 10); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").width(c - 10); b(".miniProductDetailsView .miniProductDetailsPanelAjaxBusy").show() } } function F(a) { var c = 1; a = b.getAttrValFromDom(a, "data-productId"); "" != a && (a = "#addtocart_" + a + "_EnteredQuantity", 0 < b(a).length && (a = b(a).val(), 0 < a && (c = a))); return c } function y(a) { var c = b(".addProductToCartErrors").data("kendoWindow"); c || (c = b(".addProductToCartErrors").kendoWindow({ draggable: !1, resizable: !1, width: "300px", height: "100px", modal: !0, actions: ["Close"], animation: !1, visible: !1 }).data("kendoWindow"), c.wrapper.addClass("ajaxCart")); c.content(a); c.center(); c.open() } function x(a) { b(".productAddedToCartWindow").html(b(a).html()); a = b(".productAddedToCartWindow").data("kendoWindow"); a.center(); a.open() } function w(a) { var c = '.header-links a[href="/cart"]', d = b.getHiddenValFromDom("#shoppingCartMenuLinkSelector"); 0 < b("#shoppingCartMenuLinkSelector").length && "" != d && (c = d, c = b("<div/>").html(c).text()); c = b(c).filter(":last"); 0 < c.length && (d = c.html(), d = /\d+/.exec(d), a = parseInt(d) + parseInt(a), c.html("(" + a + ")")) } function v() { var a = b.getHiddenValFromDom("#shoppingCartBoxUrl"), c = b.getHiddenValFromDom("#shoppingCartBoxPanelSelector"); 0 < b(c).length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(c); b(c).replaceWith(a) }, error: function (a, b, c) { } }) } function u() { var a = b.getHiddenValFromDom("#flyoutShoppingCartUrl"), c = b.getHiddenValFromDom("#flyoutShoppingCartPanelSelector"); 0 < b(c).length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(c); b(c).replaceWith(a) }, error: function (a, b, c) { } }) } function t() { var a = b.getHiddenValFromDom("#miniShoppingCartUrl"); 0 < b(".block.block-shoppingcart").length && b.ajax({ cache: !1, type: "GET", url: a, success: function (a) { a = b(a).filter(".block.block-shoppingcart"); b(".block.block-shoppingcart").replaceWith(a) }, error: function (a, b, e) { } }) } function D(a, c) { var d = { productId: a }, e = b.getHiddenValFromDom("#getMiniProductDetailsViewUrl"); b.ajax({ cache: !1, async: !1, type: "POST", data: b.toJSON(d), contentType: "application/json; charset=utf-8", url: e, success: function (a) { a = '<div class="miniProductDetailsPanelAjaxBusy"></div><div class="clear"></div>' + a; a = b(".miniProductDetailsView").data("kendoWindow").content(a); a.center(); a.open(); a = b.getAttrValFromDom(".miniProductDetailsView .miniProductDetailsViewAddToCartButton", "data-productId", 0); 0 < a && (a = ".miniProductDetailsView #addtocart_" + a + "_EnteredQuantity", 0 < b(a).length && b(a).val(c)) }, error: function (a, b, c) { } }) } function C(a) { var c = 1; a = b.getAttrValFromDom(a, "data-productId"); "" != a && (a = "#productQuantity" + a, 0 < b(a).length && (a = b(a).val(), 0 < a && (c = a))); return c } function s() { var a = b("body"); if (0 < a.length) { var c = a.height(), a = a.width(); b(".nopAjaxCartPanelAjaxBusy").height(c); b(".nopAjaxCartPanelAjaxBusy").width(a); b(".nopAjaxCartPanelAjaxBusy").show() } } function h() { b(".nopAjaxCartPanelAjaxBusy").hide() } e.waitForAjaxRequest = !1; var k = ".ajaxCartInfo"; e.closeProductAddedToCartWindow = function () { var a = b(".productAddedToCartWindow").data("kendoWindow"); a && a.close() }; var J = b.getSpikesViewPort(); !b.isMobile() && 980 < J.width && (n(), H(), I(), b("body").on("click", "input.nopAjaxCartProductListAddToCartButton", function (a) { B(a) }), b("body").on("click", "input.nopAjaxCartProductVariantAddToCartButton", function (a) { var c = !1; b(this).hasClass("miniProductDetailsViewAddToCartButton") && (c = !0); E(a, c) }), b(document).on("nopAjaxFiltersFiltrationCompleteEvent", n), b(document).on("nopQuickViewDataShownEvent", n)) })(window.nopAjaxCart = window.nopAjaxCart || {}, jQuery) });