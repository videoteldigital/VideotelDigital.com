//////////////////////////////////////////////////////////////////////////////////
// Cloud Zoom V1.0.2
// (c) 2010 by R Cecco. <http://www.professorcloud.com>
// MIT License
//
// Please retain this copyright header in all versions of the software
//////////////////////////////////////////////////////////////////////////////////
(function (b) { function q(b) { for (var c = 1; c < arguments.length; c++) b = b.replace("%" + (c - 1), arguments[c]); return b } function F(g, c) { var d = b("img", g), f, h = null, k = null, j = null, r = null, l = null, x = null, s, A = 0, v, w, B = 0, C = 0, m = 0, n = 0, D = 0, y, z, p = this, E; setTimeout(function () { if (null === k) { var b = g.width(); g.parent().append(q('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>', b / 3, b / 2 - b / 6)).find(":last").css("opacity", 0.5) } }, 200); this.removeBits = function () { j && (j.remove(), j = null); r && (r.remove(), r = null); l && (l.remove(), l = null); null !== x && (x.remove(), x = null); b(".cloud-zoom-loading", g.parent()).remove() }; this.destroy = function () { g.data("zoom", null); k && (k.unbind(), k.remove(), k = null); h && (h.remove(), h = null); this.removeBits() }; this.fadedOut = function () { h && (h.remove(), h = null); this.removeBits() }; this.controlLoop = function () { if (j) { var b = y - d.offset().left - 0.5 * v >> 0, e = z - d.offset().top - 0.5 * w >> 0; 0 > b ? b = 0 : b > d.outerWidth() - v && (b = d.outerWidth() - v); 0 > e ? e = 0 : e > d.outerHeight() - w && (e = d.outerHeight() - w); j.css({ left: b, top: e }); j.css("background-position", -b + "px " + -e + "px"); B = b / d.outerWidth() * s.width >> 0; C = e / d.outerHeight() * s.height >> 0; n += (B - n) / c.smoothMove; m += (C - m) / c.smoothMove; h.css("background-position", -(n >> 0) + "px " + (-(m >> 0) + "px")) } A = setTimeout(function () { p.controlLoop() }, 30) }; this.init2 = function (b, d) { D++; 1 === d && (s = b); 2 === D && this.init() }; this.init = function () { b(".cloud-zoom-loading", g.parent()).remove(); var f = b(".mousetrap"); f && f.remove(); k = b.browser.msie ? g.parent().append(q("<div class='mousetrap' style='background-image:url(\"/Plugins/SevenSpikes.Nop.Plugins.CloudZoom/Scripts/cloud-zoom.1.0.2/DummyPageForIE.htm\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>", d.outerWidth(), d.outerHeight(), 0, 0)).find(":last") : g.parent().append(q("<div class='mousetrap' style='z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>", d.outerWidth(), d.outerHeight(), 0, 0)).find(":last"); k.bind("mousemove", this, function (b) { y = b.pageX; z = b.pageY }); k.bind("mouseleave", this, function () { clearTimeout(A); j && j.fadeOut(299); r && r.fadeOut(299); l && l.fadeOut(299); h.fadeOut(300, function () { p.fadedOut() }); return !1 }); k.bind("mouseenter", this, function (e) { y = e.pageX; z = e.pageY; E = e.data; h && (h.stop(!0, !1), h.remove()); e = c.adjustX; var f = c.adjustY, m = d.outerWidth(), n = d.outerHeight(), t = c.zoomWidth, u = c.zoomHeight; "auto" == c.zoomWidth && (t = m); "auto" == c.zoomHeight && (u = n); var p = g.parent(); switch (c.position) { case "top": f -= u; break; case "right": e += m; break; case "bottom": f += n; break; case "left": e -= t; break; case "inside": t = m; u = n; break; default: p = b("#" + c.position), p.length ? (t = c.zoomWidth, u = c.zoomHeight) : (p = g, e += m, f += n) } h = p.append(q('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>', e, f, t, u, s.src)).find(":last"); d.attr("title") && c.showTitle && h.append(q('<div class="cloud-zoom-title">%0</div>', d.attr("title"))).find(":last").css("opacity", c.titleOpacity); b.browser.msie && 7 > b.browser.version && (x = b('<iframe frameborder="0" src="#"></iframe>').css({ position: "absolute", left: e, top: f, zIndex: 99, width: t, height: u }).insertBefore(h)); h.fadeIn(500); j && (j.remove(), j = null); v = d.outerWidth() / s.width * h.width(); w = d.outerHeight() / s.height * h.height(); j = g.append(q("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>", v, w)).find(":last"); k.css("cursor", j.css("cursor")); e = !1; c.tint && (j.css("background", 'url("' + d.attr("src") + '")'), r = g.append(q('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />', d.outerWidth(), d.outerHeight(), c.tint)).find(":last"), r.css("opacity", c.tintOpacity), e = !0, r.fadeIn(500)); c.softFocus && (j.css("background", 'url("' + d.attr("src") + '")'), l = g.append(q('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />', d.outerWidth() - 2, d.outerHeight() - 2, c.tint)).find(":last"), l.css("background", 'url("' + d.attr("src") + '")'), l.css("opacity", 0.5), e = !0, l.fadeIn(500)); e || j.css("opacity", c.lensOpacity); "inside" !== c.position && j.fadeIn(500); E.controlLoop() }) }; f = new Image; b(f).load(function () { p.init2(this, 0) }); f.src = d.attr("src"); f = new Image; b(f).load(function () { p.init2(this, 1) }); f.src = g.attr("href") } b(document).ready(function () { b(".cloud-zoom, .cloud-zoom-gallery").CloudZoom() }); b.fn.CloudZoom = function (g) { try { document.execCommand("BackgroundImageCache", !1, !0) } catch (c) { } this.each(function () { var d, c; eval("var\ta = {" + b(this).attr("rel") + "}"); d = a; b(this).is(".cloud-zoom") ? (b(this).css({ position: "relative", display: "block" }), b("img", b(this)).css({ display: "block" }), "wrap" != b(this).parent().attr("id") && b(this).wrap('<div id="wrap" style="top:0px;position:relative;"></div>'), c = b.extend({}, b.fn.CloudZoom.defaults, g), c = b.extend({}, c, d), b(this).data("zoom", new F(b(this), c))) : b(this).is(".cloud-zoom-gallery") && (c = b.extend({}, d, g), b(this).data("relOpts", c), b(this).bind("click", b(this), function (c) { var d = c.data.data("relOpts"); b("#" + d.useZoom).data("zoom").destroy(); b("#" + d.useZoom).attr("href", c.data.attr("href")); b("#" + d.useZoom).attr("rel", c.data.attr("rel")); b("#" + d.useZoom + " img").attr("src", c.data.data("relOpts").smallImage); b("#" + c.data.data("relOpts").useZoom).CloudZoom(); return !1 })) }); return this }; b.fn.CloudZoom.defaults = { zoomWidth: "auto", zoomHeight: "auto", position: "right", tint: !1, tintOpacity: 0.5, lensOpacity: 0.5, softFocus: !1, smoothMove: 3, showTitle: !0, titleOpacity: 0.5, adjustX: 0, adjustY: 0 } })(jQuery);