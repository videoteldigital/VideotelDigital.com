//////////////////////////////////////////////////////////////////////////////////
// Cloud Zoom V1.0.2
// (c) 2010 by R Cecco. <http://www.professorcloud.com>
// MIT License
//
// Please retain this copyright header in all versions of the software
//////////////////////////////////////////////////////////////////////////////////
(function (b) { function r(b) { for (var c = 1; c < arguments.length; c++) b = b.replace("%" + (c - 1), arguments[c]); return b } function G(g, c) { var d = b("img", g), f, h = null, l = null, k = null, s = null, m = null, y = null, t, B = 0, w, x, C = 0, D = 0, n = 0, p = 0, E = 0, z, A, q = this, F; setTimeout(function () { if (null === l) { var b = g.width(); g.parent().append(r('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>', b / 3, b / 2 - b / 6)).find(":last").css("opacity", 0.5) } }, 200); this.removeBits = function () { k && (k.remove(), k = null); s && (s.remove(), s = null); m && (m.remove(), m = null); null !== y && (y.remove(), y = null); b(".cloud-zoom-loading", g.parent()).remove() }; this.destroy = function () { g.data("zoom", null); l && (l.unbind(), l.remove(), l = null); h && (h.remove(), h = null); this.removeBits() }; this.fadedOut = function () { h && (h.remove(), h = null); this.removeBits() }; this.controlLoop = function () { if (k) { var b = z - d.offset().left - 0.5 * w >> 0, e = A - d.offset().top - 0.5 * x >> 0; 0 > b ? b = 0 : b > d.outerWidth() - w && (b = d.outerWidth() - w); 0 > e ? e = 0 : e > d.outerHeight() - x && (e = d.outerHeight() - x); k.css({ left: b, top: e }); k.css("background-position", -b + "px " + -e + "px"); C = b / d.outerWidth() * t.width >> 0; D = e / d.outerHeight() * t.height >> 0; p += (C - p) / c.smoothMove; n += (D - n) / c.smoothMove; h.css("background-position", -(p >> 0) + "px " + (-(n >> 0) + "px")) } B = setTimeout(function () { q.controlLoop() }, 30) }; this.init2 = function (b, d) { E++; 1 === d && (t = b); 2 === E && this.init() }; this.init = function () { b(".cloud-zoom-loading", g.parent()).remove(); var f = b(".quickViewWindow .mousetrap"); f && f.remove(); l = b.browser.msie ? g.parent().append(r("<div class='mousetrap' style='background-image:url(\"/Plugins/SevenSpikes.Nop.Plugins.QuickView/Scripts/DummyPageForIE.htm\");z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>", d.outerWidth(), d.outerHeight(), 0, 0)).find(":last") : g.parent().append(r("<div class='mousetrap' style='z-index:999;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>", d.outerWidth(), d.outerHeight(), 0, 0)).find(":last"); l.bind("mousemove", this, function (b) { z = b.pageX; A = b.pageY }); l.bind("mouseleave", this, function (b) { clearTimeout(B); k && k.fadeOut(299); s && s.fadeOut(299); m && m.fadeOut(299); h.fadeOut(300, function () { q.fadedOut() }); return !1 }); l.bind("mouseenter", this, function (e) { z = e.pageX; A = e.pageY; F = e.data; h && (h.stop(!0, !1), h.remove()); e = c.adjustX; var f = c.adjustY, n = d.outerWidth(), p = d.outerHeight(), u = c.zoomWidth, v = c.zoomHeight; "auto" == c.zoomWidth && (u = n); "auto" == c.zoomHeight && (v = p); var q = g.parent(); switch (c.position) { case "top": f -= v; break; case "right": e += n; break; case "bottom": f += p; break; case "left": e -= u; break; case "inside": u = n; v = p; break; default: q = b(".quickViewWindow #" + c.position), q.length ? (u = c.zoomWidth, v = c.zoomHeight) : (q = g, e += n, f += p) } h = q.append(r('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"></div>', e, f, u, v, t.src)).find(":last"); d.attr("title") && c.showTitle && h.append(r('<div class="cloud-zoom-title">%0</div>', d.attr("title"))).find(":last").css("opacity", c.titleOpacity); b.browser.msie && 7 > b.browser.version && (y = b('<iframe frameborder="0" src="#"></iframe>').css({ position: "absolute", left: e, top: f, zIndex: 99, width: u, height: v }).insertBefore(h)); h.fadeIn(500); k && (k.remove(), k = null); w = d.outerWidth() / t.width * h.width(); x = d.outerHeight() / t.height * h.height(); k = g.append(r("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>", w, x)).find(":last"); l.css("cursor", k.css("cursor")); e = !1; c.tint && (k.css("background", 'url("' + d.attr("src") + '")'), s = g.append(r('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />', d.outerWidth(), d.outerHeight(), c.tint)).find(":last"), s.css("opacity", c.tintOpacity), e = !0, s.fadeIn(500)); c.softFocus && (k.css("background", 'url("' + d.attr("src") + '")'), m = g.append(r('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />', d.outerWidth() - 2, d.outerHeight() - 2, c.tint)).find(":last"), m.css("background", 'url("' + d.attr("src") + '")'), m.css("opacity", 0.5), e = !0, m.fadeIn(500)); e || k.css("opacity", c.lensOpacity); "inside" !== c.position && k.fadeIn(500); F.controlLoop() }) }; f = new Image; b(f).load(function () { q.init2(this, 0) }); f.src = d.attr("src"); f = new Image; b(f).load(function () { q.init2(this, 1) }); f.src = g.attr("href") } b(document).on("nopQuickViewDataShownEvent", function () { b(".quickViewWindow .cloud-zoom, .quickViewWindow .cloud-zoom-gallery").CloudZoomQuickView() }); b.fn.CloudZoomQuickView = function (g) { try { document.execCommand("BackgroundImageCache", !1, !0) } catch (c) { } this.each(function () { var d, c; eval("var\ta = {" + b(this).attr("rel") + "}"); d = a; b(this).is(".quickViewWindow .cloud-zoom") ? (b(this).css({ position: "relative", display: "block" }), b("img", b(this)).css({ display: "block" }), "wrap" != b(this).parent().attr("id") && b(this).wrap('<div id="wrap" style="top:0px;position:relative;"></div>'), c = b.extend({}, b.fn.CloudZoomQuickView.defaults, g), c = b.extend({}, c, d), b(this).data("zoom", new G(b(this), c))) : b(this).is(".quickViewWindow .cloud-zoom-gallery") && (c = b.extend({}, d, g), b(this).data("relOpts", c), b(this).bind("click", b(this), function (c) { var d = c.data.data("relOpts"); b(".quickViewWindow #" + d.useZoom).data("zoom").destroy(); b(".quickViewWindow #" + d.useZoom).attr("href", c.data.attr("href")); b(".quickViewWindow #" + d.useZoom).attr("rel", c.data.attr("rel")); b(".quickViewWindow #" + d.useZoom + " img").attr("src", c.data.data("relOpts").smallImage); b(".quickViewWindow #" + c.data.data("relOpts").useZoom).CloudZoomQuickView(); return !1 })) }); return this }; b.fn.CloudZoomQuickView.defaults = { zoomWidth: "auto", zoomHeight: "auto", position: "right", tint: !1, tintOpacity: 0.5, lensOpacity: 0.5, softFocus: !1, smoothMove: 3, showTitle: !0, titleOpacity: 0.5, adjustX: 0, adjustY: 0 } })(jQuery);