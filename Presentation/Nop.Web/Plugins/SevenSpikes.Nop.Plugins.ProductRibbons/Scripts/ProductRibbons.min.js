/*
* Copyright 2014 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

$(document).ready(function () { (function (g, b, p) { function m() { var d = b.getAttrValFromDom(f, "data-productPagePicturesParentContainerSelector"), c = [], a = {}, e = b.getAttrValFromDom(f, "data-productId"); if (e && 0 < e && d) { var h = b(d).find(".product-ribbon"); h && 0 !== h.length || (a.productId = e, a.productElement = b(d)) } b(k).each(function () { var a = b(this).find(".product-ribbon"); a && 0 !== a.length || (a = b(this).attr("data-productid")) && 0 < a && (a = { productId: a, productElement: b(this) }, c.push(a)) }); return { productPage: a, categoryPageProducts: c } } function l(d, c, a) { var e = ""; c.productElement && (e = a ? b.getAttrValFromDom(f, "data-productPageBugPictureContainerSelector") : b.getAttrValFromDom(f, "data-productBoxPictureContainerSelector")) && (e = c.productElement.find(e)) && c.productId && 0 < c.productId && (c = c.productId, (d = a ? b(d).filter("div[data-productId='" + c + "']") : b(d).filter("a[data-productId='" + c + "']")) && 0 < d.length && (b(e).wrap('<div class="' + n + '"></div>'), b(e).after(d))) } var n = "ribbon-wrapper", f = "#product-ribbon-info"; b(f); var k = b.getAttrValFromDom(f, "data-productBoxSelector"); k && (g.showRibbons = function () { var d = 0, c = [], a = m(); a && a.productPage && a.productPage.productId && (d = a.productPage.productId); if (a && a.categoryPageProducts && 0 < a.categoryPageProducts.length) for (var e = 0; e < a.categoryPageProducts.length; e++) { var f = a.categoryPageProducts[e]; f.hasOwnProperty("productId") && c.push(f.productId) } if (d || 0 !== c.length) d = { productPageId: d, categoryPageIds: c }, c = "ProductRibbons/RetrieveProductRibbons", nop_store_directory_root && (c = nop_store_directory_root + "ProductRibbons/RetrieveProductRibbons"), b.ajax({ cache: !1, type: "POST", data: b.toJSON(d), contentType: "application/json; charset=utf-8", url: c, success: function (b) { if (b && (a && a.productPage && a.productPage.productId && l(b, a.productPage, !0), a && a.categoryPageProducts && 0 < a.categoryPageProducts.length)) for (var c = 0; c < a.categoryPageProducts.length; c++) l(b, a.categoryPageProducts[c]) }, error: function () { } }) }, g.showRibbons()) })(window.nopProductRibbons = window.nopProductRibbons || {}, jQuery); $(document).on("nopAjaxFiltersFiltrationCompleteEvent", nopProductRibbons.showRibbons) });